{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock %}

{% block title %}Checkout{% endblock %}

{% block page_header %}
<h1 class="text-center bag-page-title">Checkout</h1>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- Checkout Form Section -->
<div class="col-lg-6">
    <h4>Billing Details</h4>
    <form method="POST" action="{% url 'calculate_delivery' %}">
        {% csrf_token %}

        <!-- Personal Information -->
        <div class="form-group mb-3">
            {{ form.full_name|as_crispy_field }}
        </div>
        <div class="form-group mb-3">
            {{ form.email|as_crispy_field }}
        </div>
        <div class="form-group mb-3">
            {{ form.phone_number|as_crispy_field }}
        </div>

        <!-- Shipping Information -->
        <h4>Shipping Address</h4>
        <div class="form-group mb-3">
            {{ form.address_line_1|as_crispy_field }}
        </div>
        <div class="form-group mb-3">
            {{ form.address_line_2|as_crispy_field }}
        </div>
        <div class="form-group mb-3">
            {{ form.city|as_crispy_field }}
        </div>
        <div class="form-group mb-3">
            {{ form.postcode|as_crispy_field }}
        </div>
        <div class="form-group mb-3">
            {{ form.country|as_crispy_field }}
        </div>

        <!-- Calculate Delivery Button -->
        <button type="submit" class="btn btn-primary w-100">Calculate Delivery</button>
    </form>            
</div>

       <!-- Order Summary Section -->
<div class="col-lg-6">
    <div class="order-summary border p-3 rounded">
        <h4>Your Order</h4>
        <ul class="list-group mb-3">
            {% for item in bag_items %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ item.product.name }} x {{ item.quantity }}
                    <span>{{ item.quantity|floatformat:2 }} x £{{ item.product.price|floatformat:2 }}</span>
                </li>
            {% endfor %}
        </ul>
        <div class="border-top pt-3">
            <!-- Make sure these values are displayed correctly -->
            <p class="mb-1"><strong>Total: </strong>£{{ grand_total|floatformat:2 }}</p>
            <p class="mb-1"><strong>Delivery: </strong>£{{ delivery|default:"-"|floatformat:2 }}</p>
            <p class="mb-1"><strong>Grand Total: </strong>£{{ grand_total_with_shipping|default:"-"|floatformat:2 }}</p>
        </div>
    
        <!-- Place Order Button (shown only after delivery calculation) -->
        {% if delivery %}
        <form method="POST" action="{% url 'place_order' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-success" id="place-order-btn">Place Order</button>
        </form>
        {% endif %}
    </div>
</div>

{% endblock %}
